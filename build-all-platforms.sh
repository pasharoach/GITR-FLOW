#!/bin/bash

echo "üöÄ –°–±–æ—Ä–∫–∞ –ì–ò–¢–† FLOW v7.0.0 –¥–ª—è –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º"
echo "================================================"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ Node.js
if ! command -v node &> /dev/null; then
    echo "‚ùå Node.js –Ω–µ –Ω–∞–π–¥–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Node.js 18+ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞."
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ npm
if ! command -v npm &> /dev/null; then
    echo "‚ùå npm –Ω–µ –Ω–∞–π–¥–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ npm –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞."
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Ä—Å–∏—é Node.js
NODE_VERSION=$(node -v | cut -d'v' -f2 | cut -d'.' -f1)
if [ "$NODE_VERSION" -lt 18 ]; then
    echo "‚ùå –¢—Ä–µ–±—É–µ—Ç—Å—è Node.js 18+. –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è: $(node -v)"
    exit 1
fi

echo "‚úÖ Node.js $(node -v) –Ω–∞–π–¥–µ–Ω"
echo "‚úÖ npm $(npm -v) –Ω–∞–π–¥–µ–Ω"

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
echo ""
echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
npm install

if [ $? -ne 0 ]; then
    echo "‚ùå –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π"
    exit 1
fi

echo "‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"

# –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å–±–æ—Ä–∫–∏
echo ""
echo "üßπ –û—á–∏—Å—Ç–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–±–æ—Ä–æ–∫..."
rm -rf dist/
rm -rf node_modules/.cache/

echo "‚úÖ –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"

# –°–±–æ—Ä–∫–∞ –¥–ª—è –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º
echo ""
echo "üî® –°–±–æ—Ä–∫–∞ –¥–ª—è –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º..."

# –°–±–æ—Ä–∫–∞ –¥–ª—è Windows
echo "ü™ü –°–±–æ—Ä–∫–∞ –¥–ª—è Windows..."
npm run build -- --win --x64

# –°–±–æ—Ä–∫–∞ –¥–ª—è macOS Intel
echo "üçé –°–±–æ—Ä–∫–∞ –¥–ª—è macOS Intel..."
npm run build -- --mac --x64

# –°–±–æ—Ä–∫–∞ –¥–ª—è macOS Apple Silicon
echo "üçé –°–±–æ—Ä–∫–∞ –¥–ª—è macOS Apple Silicon..."
npm run build -- --mac --arm64

# –°–±–æ—Ä–∫–∞ –¥–ª—è Linux
echo "üêß –°–±–æ—Ä–∫–∞ –¥–ª—è Linux..."
npm run build -- --linux --x64

echo ""
echo "‚úÖ –°–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
echo ""
echo "üìÅ –§–∞–π–ª—ã —Å–±–æ—Ä–∫–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –ø–∞–ø–∫–µ 'dist':"
echo "   - Windows: –ì–ò–¢–† FLOW Setup 7.0.0.exe"
echo "   - macOS Intel: –ì–ò–¢–† FLOW-7.0.0.dmg"
echo "   - macOS Apple Silicon: –ì–ò–¢–† FLOW-7.0.0-arm64.dmg"
echo "   - Linux: –ì–ò–¢–† FLOW-7.0.0-x86_64.AppImage"
echo ""
echo "ÔøΩÔøΩ –ì–æ—Ç–æ–≤–æ –∫ —Ä–µ–ª–∏–∑—É!"
